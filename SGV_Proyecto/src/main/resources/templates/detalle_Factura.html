<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalle de Factura</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <h2>Detalle de Factura</h2>

    <!-- ✅ Fecha corregida para evitar error con #dates -->
    <p><strong>Fecha:</strong> <span th:text="${factura.fecha}"></span></p>

    <p><strong>Cliente:</strong> <span th:text="${factura.cliente.nombreCompleto}"></span></p>

    <h4>Ítems</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Descripción</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="item : ${factura.items}">
                <td th:text="${item.descripcion}"></td>
                <td th:text="${item.cantidad}"></td>
                <td th:text="${#numbers.formatDecimal(item.precioUnitario, 1, 2)}"></td>
                <td th:text="${#numbers.formatDecimal(item.cantidad * item.precioUnitario, 1, 2)}"></td>
            </tr>
        </tbody>
    </table>

    <p><strong>Subtotal:</strong> ₡<span th:text="${#numbers.formatDecimal(factura.subtotal, 1, 2)}"></span></p>
    <p><strong>IVA:</strong> ₡<span th:text="${#numbers.formatDecimal(factura.iva, 1, 2)}"></span></p>
    <p><strong>Total:</strong> ₡<span th:text="${#numbers.formatDecimal(factura.total, 1, 2)}"></span></p>

    <form th:action="@{/admin/facturas/guardar}" method="post" th:object="${factura}">
        <input type="hidden" name="cliente" th:value="${factura.cliente.id}" />

        <button type="submit" class="btn btn-primary">Confirmar y Guardar</button>
        <a th:href="@{/admin/facturas}" class="btn btn-secondary">Cancelar</a>
    </form>

</body>
</html>
